<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì”ê¸ˆ ì…ê¸ˆ (50%) | ValueLink</title>
    
    <!-- ëª¨ë°”ì¼ ìµœì í™” CSS -->
    <link rel="stylesheet" href="../styles/mobile-optimize.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --deep-blue: #1D4ED8;
            --deep-green: #166534;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --white: #FFFFFF;
            --border: #E5E7EB;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F9FAFB;
            color: var(--text-primary);
        }

        /* Container */
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            gap: 40px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-description {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .card h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        /* Success Banner */
        .success-banner {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            text-align: center;
        }

        .success-banner h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .success-banner p {
            font-size: 15px;
            opacity: 0.9;
            line-height: 1.6;
        }

        /* Project Info Card */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .info-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .project-id {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--deep-blue);
        }

        /* Payment Summary */
        .payment-summary {
            background: #F9FAFB;
            border-radius: 12px;
            padding: 24px;
            margin-top: 16px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-row:last-child {
            border-bottom: none;
            padding-top: 16px;
            margin-top: 8px;
        }

        .summary-label {
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .summary-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* ì„ ê¸ˆ ì™„ë£Œ í‘œì‹œ */
        .summary-row.deposit-complete {
            background: #ECFDF5;
            padding: 12px 16px;
            margin: 0 -16px 16px -16px;
            border-radius: 8px;
            border: 1px solid var(--success);
        }

        .summary-row.deposit-complete .summary-label {
            color: var(--success);
        }

        .summary-row.deposit-complete .summary-value {
            color: var(--success);
        }

        .check-icon {
            color: var(--success);
            font-size: 18px;
            margin-left: 8px;
        }

        /* ì”ê¸ˆ ê°•ì¡° */
        .summary-row.balance {
            background: #FEF3C7;
            padding: 16px;
            margin: 16px -16px 16px -16px;
            border-radius: 8px;
            border: 2px solid var(--warning);
        }

        .summary-row.balance .summary-label {
            font-size: 18px;
            color: #92400E;
            font-weight: 700;
        }

        .summary-row.balance .summary-value {
            font-size: 24px;
            color: #92400E;
        }

        /* Bank Account Info */
        .bank-info {
            padding: 24px;
            background: #F9FAFB;
            border: 2px solid var(--warning);
            border-radius: 12px;
        }

        .bank-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .bank-row:last-child {
            margin-bottom: 0;
        }

        .bank-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .bank-value {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .copy-button {
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 600;
            color: var(--deep-blue);
            background: white;
            border: 1px solid var(--deep-blue);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-button:hover {
            background: var(--deep-blue);
            color: white;
        }

        /* Notice Box */
        .notice-box {
            margin-top: 16px;
            padding: 16px;
            background: #DBEAFE;
            border-left: 4px solid var(--deep-blue);
            border-radius: 8px;
        }

        .notice-box strong {
            display: block;
            font-size: 15px;
            color: var(--deep-blue);
            margin-bottom: 8px;
        }

        .notice-box ul {
            margin-left: 20px;
            font-size: 14px;
            color: #1E40AF;
            line-height: 1.8;
        }

        /* Warning Box */
        .warning-box {
            margin-top: 16px;
            padding: 16px;
            background: #FEF3C7;
            border-left: 4px solid #F59E0B;
            border-radius: 8px;
        }

        .warning-box p {
            margin: 0;
            font-size: 14px;
            color: #92400E;
            line-height: 1.6;
        }

        /* Terms and Agreements */
        .terms-section {
            margin-top: 16px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-label {
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .checkbox-label.required::after {
            content: ' *';
            color: var(--danger);
        }

        .terms-link {
            color: var(--deep-blue);
            text-decoration: underline;
            cursor: pointer;
        }

        .terms-link:hover {
            color: #1E40AF;
        }

        /* Payment Button */
        .btn-payment {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: 700;
            color: white;
            background: var(--warning);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 24px;
        }

        .btn-payment:hover:not(:disabled) {
            background: #D97706;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .btn-payment:disabled {
            background: #D1D5DB;
            cursor: not-allowed;
        }

        /* Security Notice */
        .security-notice {
            margin-top: 24px;
            padding: 16px;
            background: #ECFDF5;
            border: 1px solid #10B981;
            border-radius: 12px;
            text-align: center;
        }

        .security-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .security-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .pg-logos {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .pg-logo {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #E5E7EB;
            border-top-color: var(--deep-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 15px;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div id="header-container"></div>

    <div class="container">
        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">ì”ê¸ˆ ì…ê¸ˆ (50%)</h1>
                <p class="page-description">í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰<br>ìµœì¢… ë³´ê³ ì„œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ë ¤ë©´ ì”ê¸ˆ 50%ë¥¼ ì…ê¸ˆí•´ ì£¼ì„¸ìš”.</p>
            </div>

            <!-- ë¡œë”© ìƒíƒœ -->
            <div id="loadingState" class="loading">
                <div class="loading-spinner"></div>
                <p class="loading-text">ê²°ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- í‰ê°€ ì™„ë£Œ ë°°ë„ˆ -->
            <div id="successBanner" class="success-banner" style="display: none;">
                <h2>âœ… í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                <p>ì „ë¬¸ íšŒê³„ì‚¬ì˜ ì² ì €í•œ ê²€í† ë¥¼ ê±°ì³ í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì”ê¸ˆ ì…ê¸ˆ í™•ì¸ í›„ ìµœì¢… ë³´ê³ ì„œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>

            <!-- í”„ë¡œì íŠ¸ ì •ë³´ -->
            <div id="projectInfoCard" class="card" style="display: none;">
                <h3>í”„ë¡œì íŠ¸ ì •ë³´</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">í”„ë¡œì íŠ¸ ë²ˆí˜¸</span>
                        <span class="info-value project-id" id="projectIdDisplay">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">íšŒì‚¬ëª…</span>
                        <span class="info-value" id="companyNameDisplay">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">í‰ê°€ë²•</span>
                        <span class="info-value" id="methodDisplay">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">í‰ê°€ ê¸°ì¤€ì¼</span>
                        <span class="info-value" id="valuationDateDisplay">-</span>
                    </div>
                </div>
            </div>

            <!-- ê²°ì œ ê¸ˆì•¡ -->
            <div id="paymentSummaryCard" class="card" style="display: none;">
                <h3>ğŸ’° ê²°ì œ ê¸ˆì•¡</h3>
                <div class="payment-summary">
                    <div class="summary-row">
                        <span class="summary-label">í‰ê°€ ì„œë¹„ìŠ¤</span>
                        <span class="summary-value" id="serviceName">-</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">í‰ê°€ ì„œë¹„ìŠ¤ ê¸ˆì•¡ (ì „ì•¡)</span>
                        <span class="summary-value" id="totalServiceAmount">-</span>
                    </div>

                    <!-- ì„ ê¸ˆ ì™„ë£Œ í‘œì‹œ -->
                    <div class="summary-row deposit-complete">
                        <span class="summary-label">âœ… ì„ ê¸ˆ (50%) - ì…ê¸ˆ ì™„ë£Œ</span>
                        <span class="summary-value" id="depositAmountPaid">-</span>
                    </div>

                    <!-- ì”ê¸ˆ 50% ê°•ì¡° -->
                    <div class="summary-row balance">
                        <span class="summary-label">ğŸ“ ì”ê¸ˆ (50%)</span>
                        <span class="summary-value" id="balanceAmount">-</span>
                    </div>
                </div>

                <div class="notice-box">
                    <strong>ğŸ’¡ ê²°ì œ ì•ˆë‚´</strong>
                    <ul>
                        <li><strong>ì”ê¸ˆ ì…ê¸ˆ í™•ì¸ í›„</strong> ìµœì¢… ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥</li>
                        <li>ì…ê¸ˆ í™•ì¸ì€ ì˜ì—…ì¼ ê¸°ì¤€ 1ì¼ ì´ë‚´ì— ì²˜ë¦¬ë©ë‹ˆë‹¤</li>
                        <li>í™•ì¸ ì™„ë£Œ ì‹œ ì´ë©”ì¼ë¡œ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤</li>
                    </ul>
                </div>
            </div>

            <!-- ë¬´í†µì¥ ì…ê¸ˆ ì•ˆë‚´ -->
            <div id="paymentMethodCard" class="card" style="display: none;">
                <h3>ğŸ¦ ì…ê¸ˆ ê³„ì¢Œ ì•ˆë‚´</h3>
                <p style="color: var(--text-secondary); margin-bottom: 24px; font-size: 15px; line-height: 1.6;">
                    ì•„ë˜ ê³„ì¢Œë¡œ ì”ê¸ˆ 50%ë¥¼ ì…ê¸ˆí•´ì£¼ì‹œë©´ ê´€ë¦¬ìê°€ í™•ì¸ í›„ ìµœì¢… ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
                </p>

                <!-- ì…ê¸ˆ ê³„ì¢Œ ì •ë³´ -->
                <div class="bank-info">
                    <div class="bank-row">
                        <span class="bank-label">ì€í–‰ëª…</span>
                        <span class="bank-value">êµ­ë¯¼ì€í–‰</span>
                    </div>
                    <div class="bank-row">
                        <span class="bank-label">ê³„ì¢Œë²ˆí˜¸</span>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <span class="bank-value" id="accountNumber">123-456-789012</span>
                            <button class="copy-button" onclick="copyAccountNumber()">ë³µì‚¬</button>
                        </div>
                    </div>
                    <div class="bank-row">
                        <span class="bank-label">ì˜ˆê¸ˆì£¼</span>
                        <span class="bank-value">(ì£¼)ë°¸ë¥˜ë§í¬</span>
                    </div>
                    <div class="bank-row" style="margin-top: 16px; padding-top: 16px; border-top: 2px solid var(--warning);">
                        <span class="bank-label" style="font-size: 16px; color: #92400E;">ì”ê¸ˆ ì…ê¸ˆ ê¸ˆì•¡ (50%)</span>
                        <span class="bank-value" id="balanceAmountBank" style="color: #92400E; font-size: 20px;">-</span>
                    </div>
                </div>

                <div class="warning-box">
                    <p>
                        <strong>âš ï¸ ì…ê¸ˆ ì‹œ ìœ ì˜ì‚¬í•­</strong><br>
                        â€¢ ì…ê¸ˆìëª…ì€ <strong>íšŒì‚¬ëª…</strong>ìœ¼ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”<br>
                        â€¢ ì”ê¸ˆ ì…ê¸ˆ í™•ì¸ í›„ ìµœì¢… ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥<br>
                        â€¢ ì…ê¸ˆ í™•ì¸ì€ ì˜ì—…ì¼ ê¸°ì¤€ 1ì¼ ì´ë‚´ì— ì²˜ë¦¬ë©ë‹ˆë‹¤<br>
                        â€¢ í™•ì¸ ì™„ë£Œ ì‹œ ì´ë©”ì¼ë¡œ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤
                    </p>
                </div>

                <!-- ì•½ê´€ ë™ì˜ -->
                <div class="terms-section">
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="termsPayment" required>
                            <label for="termsPayment" class="checkbox-label required">
                                ê²°ì œ ëŒ€í–‰ ì„œë¹„ìŠ¤ ì•½ê´€ ë™ì˜
                                <a href="#" class="terms-link" onclick="showTerms('payment'); return false;">(ì „ë¬¸ë³´ê¸°)</a>
                            </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="termsPrivacy" required>
                            <label for="termsPrivacy" class="checkbox-label required">
                                ê°œì¸ì •ë³´ ì œ3ì ì œê³µ ë™ì˜
                                <a href="#" class="terms-link" onclick="showTerms('privacy'); return false;">(ì „ë¬¸ë³´ê¸°)</a>
                            </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="termsRefund" required>
                            <label for="termsRefund" class="checkbox-label required">
                                í™˜ë¶ˆ ê·œì • í™•ì¸
                                <a href="#" class="terms-link" onclick="showTerms('refund'); return false;">(ì „ë¬¸ë³´ê¸°)</a>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- ê²°ì œ ë²„íŠ¼ -->
                <button id="btnPay" class="btn-payment" disabled>ì”ê¸ˆ ì…ê¸ˆ ì™„ë£Œ í™•ì¸</button>

                <!-- ë³´ì•ˆ ì•ˆë‚´ -->
                <div class="security-notice">
                    <div class="security-icon">ğŸ”’</div>
                    <p class="security-text">SSL ë³´ì•ˆ ê²°ì œë¡œ ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤</p>
                    <div class="pg-logos">
                        <span class="pg-logo">êµ­ë¯¼ì€í–‰</span>
                        <span class="pg-logo">ì•ˆì‹¬ ì…ê¸ˆ</span>
                        <span class="pg-logo">ë¬´í†µì¥ ì…ê¸ˆ</span>
                    </div>
                </div>
            </div>
        </main>

    </div>

    <!-- í—¤ë” ë¡œë“œ -->
    <script>
        fetch('../../components/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                const scripts = document.getElementById('header-container').querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });
            })
            .catch(error => console.error('í—¤ë” ë¡œë“œ ì‹¤íŒ¨:', error));
    </script>

    <!-- í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        import { checkMethodStatus, METHOD_NAMES, STATUS } from '../../components/project-status-checker.js';

        // Supabase í´ë¼ì´ì–¸íŠ¸
        const SUPABASE_URL = 'https://arxrfetgaitkgiiqabap.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeHJmZXRnYWl0a2dpaXFhYmFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3ODk1OTgsImV4cCI6MjA4NDM2NTU5OH0.BTnuv0sYr2MGe1c-gk8PWCviwkFyIiymfKp5Jhzwbo0';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // í‰ê°€ë²•ë³„ ê°€ê²© (ì›)
        const METHOD_PRICES = {
            dcf: 3000000,              // 300ë§Œì›
            relative: 2500000,         // 250ë§Œì›
            intrinsic: 2800000,        // 280ë§Œì›
            asset: 2000000,            // 200ë§Œì›
            inheritance_tax: 3500000   // 350ë§Œì›
        };

        let projectId, method, balancePaymentAmount;

        async function loadPaymentPage() {
            try {
                // URL íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
                const urlParams = new URLSearchParams(window.location.search);
                projectId = urlParams.get('projectId');
                method = urlParams.get('method');

                if (!projectId || !method) {
                    alert('ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');
                    window.location.href = '../valuation.html';
                    return;
                }

                // í‰ê°€ë²• ìƒíƒœ í™•ì¸ (Step 13 - ì”ê¸ˆ ì…ê¸ˆ)
                const methodStatus = await checkMethodStatus(projectId, method);
                if (methodStatus.status !== STATUS.IN_PROGRESS || methodStatus.step !== 13) {
                    alert('ì”ê¸ˆ ì…ê¸ˆ ë‹¨ê³„ê°€ ì•„ë‹™ë‹ˆë‹¤.');
                    window.location.href = '../valuation.html';
                    return;
                }

                // í”„ë¡œì íŠ¸ ì •ë³´ ì¡°íšŒ
                const { data: project, error } = await supabase
                    .from('projects')
                    .select('*')
                    .eq('project_id', projectId)
                    .single();

                if (error || !project) {
                    console.error('í”„ë¡œì íŠ¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    alert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ
                displayProjectInfo(project);

                // ê²°ì œ ê¸ˆì•¡ ê³„ì‚° ë° í‘œì‹œ
                calculateAndDisplayPayment();

                // ë¡œë”© ìˆ¨ê¹€
                document.getElementById('loadingState').style.display = 'none';
                showCards();

            } catch (error) {
                console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function displayProjectInfo(project) {
            document.getElementById('projectIdDisplay').textContent = project.project_id;
            document.getElementById('companyNameDisplay').textContent = (project.company_name || '-');
            document.getElementById('methodDisplay').textContent = METHOD_NAMES[method];
            document.getElementById('valuationDateDisplay').textContent = project.valuation_date || '-';
        }

        function calculateAndDisplayPayment() {
            const totalPrice = METHOD_PRICES[method] || 0;
            const depositAmount = Math.floor(totalPrice * 0.5);  // ì„ ê¸ˆ 50% (ì´ë¯¸ ì™„ë£Œ)
            const balanceAmount = totalPrice - depositAmount;    // ì”ê¸ˆ 50%

            balancePaymentAmount = balanceAmount;

            // ê¸ˆì•¡ í‘œì‹œ (ì²œ ë‹¨ìœ„ ì½¤ë§ˆ)
            document.getElementById('serviceName').textContent = METHOD_NAMES[method];
            document.getElementById('totalServiceAmount').textContent = formatCurrency(totalPrice);
            document.getElementById('depositAmountPaid').textContent = formatCurrency(depositAmount);
            document.getElementById('balanceAmount').textContent = formatCurrency(balanceAmount);
            document.getElementById('balanceAmountBank').textContent = formatCurrency(balanceAmount);

            // ê²°ì œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updatePaymentButtonText(balanceAmount);
        }

        function formatCurrency(amount) {
            return 'â‚©' + amount.toLocaleString('ko-KR');
        }

        function updatePaymentButtonText(amount) {
            const btnPay = document.getElementById('btnPay');
            btnPay.textContent = `ì”ê¸ˆ ì…ê¸ˆ ì™„ë£Œ í™•ì¸ (${formatCurrency(amount)})`;
        }

        function showCards() {
            document.getElementById('successBanner').style.display = 'block';
            document.getElementById('projectInfoCard').style.display = 'block';
            document.getElementById('paymentSummaryCard').style.display = 'block';
            document.getElementById('paymentMethodCard').style.display = 'block';
        }

        // ì•½ê´€ ë™ì˜ ì²´í¬
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', checkTermsAndEnableButton);
        });

        function checkTermsAndEnableButton() {
            const termsPayment = document.getElementById('termsPayment').checked;
            const termsPrivacy = document.getElementById('termsPrivacy').checked;
            const termsRefund = document.getElementById('termsRefund').checked;

            const allChecked = termsPayment && termsPrivacy && termsRefund;
            document.getElementById('btnPay').disabled = !allChecked;
        }

        // ì”ê¸ˆ ì…ê¸ˆ ë²„íŠ¼ í´ë¦­
        document.getElementById('btnPay').addEventListener('click', async () => {
            // ì”ê¸ˆ ì…ê¸ˆ í™•ì¸ ë©”ì‹œì§€
            const confirmMessage = `ì”ê¸ˆ 50% ${formatCurrency(balancePaymentAmount)}ì„\nìœ„ ê³„ì¢Œë¡œ ì…ê¸ˆí•˜ì…¨ìŠµë‹ˆê¹Œ?\n\nì…ê¸ˆ í™•ì¸ í›„ ìµœì¢… ë³´ê³ ì„œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;

            if (!confirm(confirmMessage)) {
                return;
            }

            // ì”ê¸ˆ ì…ê¸ˆ ì•ˆë‚´ ì•Œë¦¼
            alert(`ì”ê¸ˆ ì…ê¸ˆì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“‹ ì…ê¸ˆ ì •ë³´
â€¢ ì€í–‰: êµ­ë¯¼ì€í–‰
â€¢ ê³„ì¢Œë²ˆí˜¸: 123-456-789012
â€¢ ì˜ˆê¸ˆì£¼: (ì£¼)ë°¸ë¥˜ë§í¬
â€¢ ì”ê¸ˆ (50%): ${formatCurrency(balancePaymentAmount)}

ê´€ë¦¬ìê°€ ì…ê¸ˆ í™•ì¸ í›„ ìµœì¢… ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ì´ë©”ì¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.

âœ… í‰ê°€ ì™„ë£Œ!
ì…ê¸ˆ í™•ì¸ í›„ ìµœì¢… ë³´ê³ ì„œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);

            // í˜ì´ì§€ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ (ê´€ë¦¬ìê°€ ì…ê¸ˆ í™•ì¸ í›„ Step 14ë¡œ ë³€ê²½)
            console.log('ì”ê¸ˆ ì…ê¸ˆ ëŒ€ê¸° ìƒíƒœ - ê´€ë¦¬ì í™•ì¸ í•„ìš”');
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        loadPaymentPage();
    </script>

    <!-- ì „ì—­ í•¨ìˆ˜ -->
    <script>
        // ê³„ì¢Œë²ˆí˜¸ ë³µì‚¬
        function copyAccountNumber() {
            const accountNumber = document.getElementById('accountNumber').textContent;
            navigator.clipboard.writeText(accountNumber).then(() => {
                alert('ê³„ì¢Œë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
            });
        }

        // ì•½ê´€ ì „ë¬¸ ë³´ê¸°
        function showTerms(type) {
            const titles = {
                payment: 'ê²°ì œ ëŒ€í–‰ ì„œë¹„ìŠ¤ ì•½ê´€',
                privacy: 'ê°œì¸ì •ë³´ ì œ3ì ì œê³µ ë™ì˜',
                refund: 'í™˜ë¶ˆ ê·œì •'
            };

            const contents = {
                payment: 'ê²°ì œ ëŒ€í–‰ ì„œë¹„ìŠ¤ëŠ” ë¬´í†µì¥ ì…ê¸ˆ ë°©ì‹ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤. ì”ê¸ˆ 50% ì…ê¸ˆ í›„ ìµœì¢… ë³´ê³ ì„œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤...',
                privacy: 'ê²°ì œ ì²˜ë¦¬ë¥¼ ìœ„í•´ ê·€í•˜ì˜ ê°œì¸ì •ë³´ê°€ ì€í–‰ ë° PGì‚¬ì— ì œê³µë©ë‹ˆë‹¤...',
                refund: 'í‰ê°€ ì™„ë£Œ í›„ì—ëŠ” í™˜ë¶ˆì´ ì œí•œë©ë‹ˆë‹¤. ìì„¸í•œ ì‚¬í•­ì€ ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”...'
            };

            alert(`${titles[type]}\n\n${contents[type]}`);
        }
    </script>
</body>
</html>
