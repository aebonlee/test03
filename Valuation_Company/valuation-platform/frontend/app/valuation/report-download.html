<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰ê°€ë³´ê³ ì„œ ìˆ˜ë ¹ | ValueLink</title>
    
    <!-- ëª¨ë°”ì¼ ìµœì í™” CSS -->
    <link rel="stylesheet" href="../styles/mobile-optimize.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --deep-blue: #1D4ED8;
            --deep-green: #166534;
            --light-green: #DCFCE7;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --white: #FFFFFF;
            --border: #E5E7EB;
            --success-green: #10B981;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F9FAFB;
            color: var(--text-primary);
        }

        /* Confetti Animation */
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--success-green);
            top: -10px;
            animation: confetti-fall 3s linear;
            pointer-events: none;
            z-index: 9999;
        }

        /* Container */
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            gap: 40px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-description {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* Success Message */
        .success-message {
            background: linear-gradient(135deg, var(--light-green) 0%, #DCFCE7 100%);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 24px;
            text-align: center;
            border: 2px solid var(--deep-green);
        }

        .celebration-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .success-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--deep-green);
            margin-bottom: 8px;
        }

        .success-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* Project Info Card */
        .project-info-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .project-info-card h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .info-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .project-id {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--deep-blue);
        }

        .valuation-amount {
            font-size: 20px;
            font-weight: 700;
            color: var(--deep-green);
        }

        /* Report Summary */
        .report-summary {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .report-summary h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        /* Download Section */
        .download-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .download-section h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .main-report-card {
            background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%);
            border: 2px solid var(--deep-green);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .report-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .report-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .report-filename {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .report-size {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .btn-download-large {
            width: 100%;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 700;
            color: white;
            background: var(--deep-green);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-download-large:hover {
            background: #15803D;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(22, 101, 52, 0.3);
        }

        .btn-download-large:active {
            transform: translateY(0);
        }

        .download-icon {
            font-size: 20px;
        }

        /* Attachments */
        .attachments {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #F9FAFB;
            border: 1px solid var(--border);
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .attachment-item:hover {
            background: #F3F4F6;
            border-color: #D1D5DB;
        }

        .attachment-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .attachment-icon {
            font-size: 24px;
        }

        .attachment-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .attachment-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .attachment-size {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .btn-download-small {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            background: var(--deep-blue);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-download-small:hover {
            background: #1E40AF;
        }

        /* Report Preview */
        .report-preview {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .report-preview h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .preview-thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .thumbnail {
            position: relative;
            aspect-ratio: 1 / 1.4;
            background: #F9FAFB;
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .thumbnail:hover {
            border-color: var(--deep-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .thumbnail-icon {
            font-size: 48px;
            opacity: 0.3;
        }

        .thumbnail-page {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: var(--deep-blue);
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .btn-preview {
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            color: var(--deep-blue);
            background: white;
            border: 2px solid var(--deep-blue);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-preview:hover {
            background: var(--deep-blue);
            color: white;
        }

        /* Next Steps */
        .next-steps {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .next-steps h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .next-steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .next-step-btn {
            padding: 16px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            background: #F9FAFB;
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .next-step-btn:hover {
            background: #F3F4F6;
            border-color: var(--deep-blue);
            color: var(--deep-blue);
        }

        /* History Section */
        .history-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .history-section h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #F9FAFB;
            border-radius: 8px;
        }

        .version-badge {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            background: var(--text-secondary);
            color: white;
            border-radius: 4px;
        }

        .version-badge.current {
            background: var(--deep-green);
        }

        /* Satisfaction Survey */
        .satisfaction-survey {
            background: white;
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .satisfaction-survey h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .survey-question {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .star-rating {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .star {
            font-size: 32px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .star:hover,
        .star.active {
            transform: scale(1.2);
        }

        .feedback-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            font-size: 14px;
            font-family: inherit;
            border: 1px solid var(--border);
            border-radius: 8px;
            resize: vertical;
            margin-bottom: 16px;
        }

        .feedback-textarea:focus {
            outline: none;
            border-color: var(--deep-blue);
        }

        .btn-submit-survey {
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            background: var(--deep-blue);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-submit-survey:hover {
            background: #1E40AF;
        }

        .survey-submitted {
            padding: 16px;
            background: var(--light-green);
            border: 1px solid var(--deep-green);
            border-radius: 8px;
            text-align: center;
            color: var(--deep-green);
            font-weight: 600;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #E5E7EB;
            border-top-color: var(--deep-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 15px;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .next-steps-grid {
                grid-template-columns: 1fr;
            }

            .preview-thumbnails {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div id="header-container"></div>

    <div class="container">
        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- ë¡œë”© ìƒíƒœ -->
            <div id="loadingState" class="loading">
                <div class="loading-spinner"></div>
                <p class="loading-text">í‰ê°€ë³´ê³ ì„œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- ë©”ì¸ ì»¨í…ì¸  (ë¡œë”© í›„ í‘œì‹œ) -->
            <div id="mainContent" style="display: none;">
                <!-- ì„±ê³µ ë©”ì‹œì§€ -->
                <div class="success-message">
                    <div class="celebration-icon">ğŸ‰</div>
                    <h2 class="success-title">í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                    <p class="success-subtitle">ê·€ì‚¬ì˜ ê¸°ì—…ê°€ì¹˜ í‰ê°€ë³´ê³ ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                </div>

                <div class="page-header">
                    <h1 class="page-title">í‰ê°€ë³´ê³ ì„œ ìˆ˜ë ¹</h1>
                    <p class="page-description">í‰ê°€ë³´ê³ ì„œê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œí•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.</p>
                </div>

                <!-- í”„ë¡œì íŠ¸ ì •ë³´ -->
                <div class="project-info-card">
                    <h3>í”„ë¡œì íŠ¸ ì •ë³´</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">í”„ë¡œì íŠ¸ ë²ˆí˜¸</span>
                            <span class="info-value project-id" id="projectIdDisplay">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">íšŒì‚¬ëª…</span>
                            <span class="info-value" id="companyNameDisplay">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">í‰ê°€ë²•</span>
                            <span class="info-value" id="methodDisplay">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">í‰ê°€ ê¸°ì¤€ì¼</span>
                            <span class="info-value" id="valuationDateDisplay">-</span>
                        </div>
                    </div>
                </div>

                <!-- í‰ê°€ë³´ê³ ì„œ ìš”ì•½ -->
                <div class="report-summary">
                    <h3>í‰ê°€ë³´ê³ ì„œ ìš”ì•½</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">í‰ê°€ ì™„ë£Œì¼</span>
                            <span class="info-value" id="completionDateDisplay">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">í‰ê°€ ê¸ˆì•¡</span>
                            <span class="info-value valuation-amount" id="valuationAmountDisplay">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ë‹´ë‹¹ íšŒê³„ì‚¬</span>
                            <span class="info-value">ì„ ì›…ê·œ íšŒê³„ì‚¬</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ë³´ê³ ì„œ ë²„ì „</span>
                            <span class="info-value">v1.0 (ìµœì¢…ë³¸)</span>
                        </div>
                    </div>
                </div>

                <!-- ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ -->
                <div class="download-section">
                    <h3>í‰ê°€ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ</h3>

                    <!-- ë©”ì¸ ë³´ê³ ì„œ -->
                    <div class="main-report-card">
                        <div class="report-icon">ğŸ“„</div>
                        <div class="report-title">í‰ê°€ë³´ê³ ì„œ (ìµœì¢…ë³¸)</div>
                        <div class="report-filename" id="reportFilename">-</div>
                        <div class="report-size">íŒŒì¼ í¬ê¸°: <span id="reportSize">2.5MB</span></div>
                        <button class="btn-download-large" id="btnDownloadReport">
                            <span class="download-icon">â¬‡ï¸</span>
                            í‰ê°€ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>

                    <!-- ì²¨ë¶€ íŒŒì¼ -->
                    <div class="attachments" id="attachmentsList" style="display: none;">
                        <div class="attachment-item">
                            <div class="attachment-info">
                                <span class="attachment-icon">ğŸ“Š</span>
                                <div class="attachment-details">
                                    <span class="attachment-name">ì¬ë¬´ ë°ì´í„°.xlsx</span>
                                    <span class="attachment-size">854KB</span>
                                </div>
                            </div>
                            <button class="btn-download-small">ë‹¤ìš´ë¡œë“œ</button>
                        </div>
                        <div class="attachment-item">
                            <div class="attachment-info">
                                <span class="attachment-icon">ğŸ“¦</span>
                                <div class="attachment-details">
                                    <span class="attachment-name">ì¶”ê°€ ìë£Œ.zip</span>
                                    <span class="attachment-size">1.2MB</span>
                                </div>
                            </div>
                            <button class="btn-download-small">ë‹¤ìš´ë¡œë“œ</button>
                        </div>
                    </div>
                </div>

                <!-- ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸° -->
                <div class="report-preview">
                    <h3>ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸°</h3>
                    <div class="preview-thumbnails">
                        <div class="thumbnail">
                            <span class="thumbnail-icon">ğŸ“„</span>
                            <span class="thumbnail-page">1</span>
                        </div>
                        <div class="thumbnail">
                            <span class="thumbnail-icon">ğŸ“Š</span>
                            <span class="thumbnail-page">2</span>
                        </div>
                        <div class="thumbnail">
                            <span class="thumbnail-icon">ğŸ“ˆ</span>
                            <span class="thumbnail-page">3</span>
                        </div>
                        <div class="thumbnail">
                            <span class="thumbnail-icon">ğŸ“‰</span>
                            <span class="thumbnail-page">4</span>
                        </div>
                    </div>
                    <button class="btn-preview" id="btnPreview">ì „ì²´ ë¯¸ë¦¬ë³´ê¸°</button>
                </div>

                <!-- ë‹¤ìŒ ë‹¨ê³„ -->
                <div class="next-steps">
                    <h3>ë‹¤ìŒ ë‹¨ê³„</h3>
                    <div class="next-steps-grid">
                        <a href="#" class="next-step-btn">
                            ğŸ“– í‰ê°€ë³´ê³ ì„œ í™œìš© ê°€ì´ë“œ
                        </a>
                        <a href="../projects/project-create.html" class="next-step-btn">
                            â• ì¶”ê°€ í‰ê°€ ì‹ ì²­
                        </a>
                        <a href="../valuation.html" class="next-step-btn">
                            ğŸ’¬ ë¬¸ì˜í•˜ê¸°
                        </a>
                    </div>
                </div>

                <!-- ì´ì „ ë²„ì „ ì´ë ¥ -->
                <div class="history-section" id="historySection" style="display: none;">
                    <h3>ë³´ê³ ì„œ ë²„ì „ ì´ë ¥</h3>
                    <div class="history-list">
                        <div class="history-item">
                            <div>
                                <span class="version-badge current">v1.0</span>
                                <span style="margin-left: 12px; font-weight: 600;">ìµœì¢…ë³¸</span>
                                <span style="margin-left: 8px; color: var(--text-secondary); font-size: 13px;">2026-01-26</span>
                            </div>
                            <button class="btn-download-small">ë‹¤ìš´ë¡œë“œ</button>
                        </div>
                    </div>
                </div>

                <!-- ë§Œì¡±ë„ ì¡°ì‚¬ -->
                <div class="satisfaction-survey">
                    <h3>ì„œë¹„ìŠ¤ ë§Œì¡±ë„ ì¡°ì‚¬</h3>
                    <div id="surveyForm">
                        <div class="survey-question">ì„œë¹„ìŠ¤ëŠ” ë§Œì¡±í•˜ì…¨ë‚˜ìš”?</div>
                        <div class="star-rating" id="starRating">
                            <span class="star" data-rating="1">â­</span>
                            <span class="star" data-rating="2">â­</span>
                            <span class="star" data-rating="3">â­</span>
                            <span class="star" data-rating="4">â­</span>
                            <span class="star" data-rating="5">â­</span>
                        </div>
                        <textarea
                            class="feedback-textarea"
                            id="feedbackText"
                            placeholder="ì„œë¹„ìŠ¤ ì´ìš© ì†Œê°ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš” (ì„ íƒì‚¬í•­)"
                        ></textarea>
                        <button class="btn-submit-survey" id="btnSubmitSurvey">ì˜ê²¬ ì œì¶œ</button>
                    </div>
                    <div id="surveySubmitted" class="survey-submitted" style="display: none;">
                        âœ… ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤!
                    </div>
                </div>
            </div>
        </main>

    </div>

    <!-- í—¤ë” ë¡œë“œ -->
    <script>
        fetch('../../components/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                const scripts = document.getElementById('header-container').querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });
            })
            .catch(error => console.error('í—¤ë” ë¡œë“œ ì‹¤íŒ¨:', error));
    </script>

    <!-- í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        import { checkMethodStatus, METHOD_NAMES, STATUS } from '../../components/project-status-checker.js';

        // Supabase í´ë¼ì´ì–¸íŠ¸
        const SUPABASE_URL = 'https://arxrfetgaitkgiiqabap.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeHJmZXRnYWl0a2dpaXFhYmFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3ODk1OTgsImV4cCI6MjA4NDM2NTU5OH0.BTnuv0sYr2MGe1c-gk8PWCviwkFyIiymfKp5Jhzwbo0';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // ì „ì—­ ë³€ìˆ˜
        let projectId, method, selectedRating = 0, downloadCount = 0;

        // API Base URL
        const API_BASE_URL = 'http://localhost:8000/api/v1';

        // Confetti ì• ë‹ˆë©”ì´ì…˜ ìƒì„±
        function createConfetti() {
            const colors = ['#10B981', '#3B82F6', '#F59E0B', '#EF4444', '#8B5CF6'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }

        // APIë¡œë¶€í„° í‰ê°€ ê²°ê³¼ ë¡œë“œ
        async function loadValuationResult() {
            try {
                const response = await fetch(
                    `${API_BASE_URL}/valuation/result?project_id=${projectId}&method=${method}`
                );

                if (!response.ok) {
                    console.warn('Failed to fetch valuation result from API, using fallback data');
                    return null;
                }

                const data = await response.json();

                // í‰ê°€ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
                const valuationAmountElement = document.getElementById('valuationAmountDisplay');
                if (valuationAmountElement && data.valuation_amount) {
                    const currency = data.currency === 'KRW' ? 'ì›' : data.currency;
                    const formattedAmount = data.valuation_amount.toLocaleString('ko-KR');
                    valuationAmountElement.textContent = `â‚©${formattedAmount}`;
                }

                // ì™„ë£Œì¼ ì—…ë°ì´íŠ¸
                const completionDateElement = document.getElementById('completionDateDisplay');
                if (completionDateElement && data.completed_at) {
                    const completedDate = new Date(data.completed_at);
                    completionDateElement.textContent = completedDate.toLocaleDateString('ko-KR');
                }

                // ë³´ê³ ì„œ URL ì—…ë°ì´íŠ¸ (ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì— ì €ì¥)
                if (data.report_url) {
                    const btnDownloadReport = document.getElementById('btnDownloadReport');
                    btnDownloadReport.dataset.reportUrl = data.report_url;
                }

                return data;

            } catch (error) {
                console.error('Failed to load valuation result:', error);
                return null;
            }
        }

        async function loadReportData() {
            try {
                // URL íŒŒë¼ë¯¸í„°
                const urlParams = new URLSearchParams(window.location.search);
                projectId = urlParams.get('projectId');
                method = urlParams.get('method');

                if (!projectId || !method) {
                    alert('í”„ë¡œì íŠ¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    window.location.href = '../core/project-list.html';
                    return;
                }

                // í‰ê°€ë²• ìƒíƒœ í™•ì¸
                const methodStatus = await checkMethodStatus(projectId, method);
                if (methodStatus.status !== STATUS.COMPLETED) {
                    alert('ì•„ì§ í‰ê°€ê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    window.location.href = '../approval-waiting.html?projectId=' + projectId;
                    return;
                }

                // í”„ë¡œì íŠ¸ ì •ë³´ ì¡°íšŒ
                const { data: project, error } = await supabase
                    .from('projects')
                    .select('*')
                    .eq('project_id', projectId)
                    .single();

                if (error || !project) {
                    console.error('í”„ë¡œì íŠ¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    alert('í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ
                displayProjectInfo(project);

                // APIë¡œë¶€í„° í‰ê°€ ê²°ê³¼ ë¡œë“œ
                await loadValuationResult();

                // ë¡œë”© ìˆ¨ê¹€, ë©”ì¸ ì»¨í…ì¸  í‘œì‹œ
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';

                // Confetti ì• ë‹ˆë©”ì´ì…˜
                createConfetti();

            } catch (error) {
                console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function displayProjectInfo(project) {
            document.getElementById('projectIdDisplay').textContent = project.project_id;
            document.getElementById('companyNameDisplay').textContent =
                project.company_name || '-';
            document.getElementById('methodDisplay').textContent = METHOD_NAMES[method];
            document.getElementById('valuationDateDisplay').textContent = project.valuation_date || '-';

            // í‰ê°€ ì™„ë£Œì¼ (ê¸°ë³¸ê°’: í˜„ì¬ ë‚ ì§œ)
            const today = new Date().toISOString().split('T')[0];
            const completionDateElement = document.getElementById('completionDateDisplay');
            if (completionDateElement.textContent === '-') {
                completionDateElement.textContent = today;
            }

            // í‰ê°€ ê¸ˆì•¡ (ê¸°ë³¸ê°’: ì„ì‹œ ê°’, APIë¡œë¶€í„° ë¡œë“œë˜ë©´ ë®ì–´ì”Œì›Œì§)
            const valuationAmountElement = document.getElementById('valuationAmountDisplay');
            if (valuationAmountElement.textContent === '-') {
                const amount = (Math.random() * 50 + 50).toFixed(1); // 50~100ì–µ ëœë¤
                valuationAmountElement.textContent = `${amount}ì–µì›`;
            }

            // íŒŒì¼ëª… ìƒì„±
            const filename = `${project.company_name || 'íšŒì‚¬'}_ê¸°ì—…ê°€ì¹˜í‰ê°€ë³´ê³ ì„œ_${METHOD_NAMES[method]}_${today}.pdf`;
            document.getElementById('reportFilename').textContent = filename;
        }

        // ë©”ì¸ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
        document.getElementById('btnDownloadReport').addEventListener('click', async () => {
            downloadCount++;

            // ë‹¤ìš´ë¡œë“œ ì¹´ìš´íŠ¸ ê¸°ë¡
            console.log(`Download count: ${downloadCount}`);

            const btnDownloadReport = document.getElementById('btnDownloadReport');
            const reportUrl = btnDownloadReport.dataset.reportUrl;

            if (reportUrl) {
                // APIë¡œë¶€í„° ë°›ì€ ì‹¤ì œ ë³´ê³ ì„œ URLì´ ìˆìœ¼ë©´ ë‹¤ìš´ë¡œë“œ
                const link = document.createElement('a');
                link.href = reportUrl;
                link.download = document.getElementById('reportFilename').textContent;
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                console.log('Downloaded report from:', reportUrl);
            } else {
                // Fallback: API ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€
                alert('ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤.\n\n(ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” PDF íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤)');
            }
        });

        // ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼
        document.getElementById('btnPreview').addEventListener('click', () => {
            alert('ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸° í˜ì´ì§€ê°€ ìƒˆ íƒ­ì—ì„œ ì—´ë¦½ë‹ˆë‹¤.\n\n(ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” PDF ë·°ì–´ê°€ ì—´ë¦½ë‹ˆë‹¤)');

            // TODO: ì‹¤ì œ PDF ë·°ì–´ ì—´ê¸°
            // window.open('/path/to/report.pdf', '_blank');
        });

        // ë³„ì  í´ë¦­
        const stars = document.querySelectorAll('.star');
        stars.forEach(star => {
            star.addEventListener('click', () => {
                const rating = parseInt(star.dataset.rating);
                selectedRating = rating;

                // ë³„ì  í‘œì‹œ ì—…ë°ì´íŠ¸
                stars.forEach((s, index) => {
                    if (index < rating) {
                        s.classList.add('active');
                    } else {
                        s.classList.remove('active');
                    }
                });
            });
        });

        // ë§Œì¡±ë„ ì¡°ì‚¬ ì œì¶œ
        document.getElementById('btnSubmitSurvey').addEventListener('click', async () => {
            if (selectedRating === 0) {
                alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const feedback = document.getElementById('feedbackText').value;

            try {
                // TODO: ì‹¤ì œ DBì— ì €ì¥
                console.log('Survey submitted:', {
                    projectId,
                    method,
                    rating: selectedRating,
                    feedback
                });

                // UI ì—…ë°ì´íŠ¸
                document.getElementById('surveyForm').style.display = 'none';
                document.getElementById('surveySubmitted').style.display = 'block';

            } catch (error) {
                console.error('ë§Œì¡±ë„ ì¡°ì‚¬ ì œì¶œ ì‹¤íŒ¨:', error);
                alert('ì˜ê²¬ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        loadReportData();
    </script>
</body>
</html>
