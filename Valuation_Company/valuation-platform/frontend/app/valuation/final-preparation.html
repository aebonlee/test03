<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰ê°€ë³´ê³ ì„œ ìµœì¢…ì•ˆ ì‘ì„± | ValueLink</title>
    
    <!-- ëª¨ë°”ì¼ ìµœì í™” CSS -->
    <link rel="stylesheet" href="../styles/mobile-optimize.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --deep-blue: #1D4ED8;
            --deep-green: #166534;
            --amber: #F59E0B;
            --text-primary: #111827;
            --text-secondary: #374151;
            --text-muted: #6B7280;
            --white: #FFFFFF;
            --bg-light: #F3F4F6;
            --border: #E5E7EB;
            --light-blue: #EFF6FF;
            --accent-blue: #3B82F6;
            --success: #10B981;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Header styles moved to header.html component */

        /* HERO SECTION */
        .hero-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 60px 40px; color: white; text-align: center; }
        .hero-content { max-width: 1200px; margin: 0 auto; }
        .hero-title { font-size: 36px; font-weight: 700; margin-bottom: 12px; }
        .hero-subtitle { font-size: 18px; opacity: 0.9; margin-bottom: 20px; }
        .hero-badge { display: inline-block; background: rgba(255, 255, 255, 0.2); padding: 8px 16px; border-radius: 20px; font-size: 14px; }
        }

        /* Main Layout */
        .page-wrapper {
            display: flex;
            gap: 32px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        .main-content {
            flex: 1;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .page-description {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Project Info Card */
        .project-info-card {
            background: var(--white);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .project-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .project-id {
            font-size: 14px;
            color: var(--text-muted);
            font-family: monospace;
            background: var(--bg-light);
            padding: 4px 12px;
            border-radius: 4px;
            display: inline-block;
        }

        .project-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            background: #FEF3C7;
            color: #92400E;
        }

        .project-meta {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .meta-item {
            text-align: center;
        }

        .meta-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .meta-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Accountant Profile Card */
        .accountant-profile-card {
            background: var(--white);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-content {
            display: flex;
            gap: 24px;
            align-items: start;
        }

        .profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            flex-shrink: 0;
            border: 4px solid var(--light-blue);
        }

        .profile-details {
            flex: 1;
        }

        .accountant-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .accountant-certification {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .profile-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .profile-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-info-item .icon {
            font-size: 18px;
        }

        .profile-info-item .text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .profile-info-item .value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Revision Summary Card */
        .revision-summary-card {
            background: var(--white);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .revision-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .revision-count {
            background: #FEF3C7;
            color: #92400E;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .revision-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .revision-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: var(--bg-light);
            border-radius: 12px;
            border-left: 4px solid var(--amber);
        }

        .revision-number {
            width: 32px;
            height: 32px;
            background: var(--amber);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .revision-content {
            flex: 1;
        }

        .revision-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .revision-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .view-details-link {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: var(--deep-blue);
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid var(--deep-blue);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .view-details-link:hover {
            background: var(--light-blue);
        }

        /* Status Section */
        .status-section {
            background: var(--white);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 2px solid var(--accent-blue);
        }

        .status-indicator {
            text-align: center;
            padding: 40px 20px;
        }

        .status-icon {
            font-size: 64px;
            margin-bottom: 16px;
            animation: writing 2s ease-in-out infinite;
        }

        @keyframes writing {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }

        .status-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 8px;
        }

        .status-description {
            font-size: 15px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Progress Steps */
        .progress-steps {
            margin-top: 32px;
            padding: 24px;
            background: var(--bg-light);
            border-radius: 12px;
        }

        .step-item {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .step-item:last-child {
            margin-bottom: 0;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }

        .step-icon.completed {
            background: var(--success);
        }

        .step-icon.in-progress {
            background: var(--accent-blue);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        .step-icon.pending {
            background: #D1D5DB;
        }

        .step-content {
            flex: 1;
            padding-top: 4px;
        }

        .step-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .step-time {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Notice Box */
        .notice-box {
            background: #DBEAFE;
            border: 1px solid #BFDBFE;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
        }

        .notice-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--deep-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notice-text {
            font-size: 13px;
            color: #1E40AF;
            line-height: 1.6;
        }

        .notice-actions {
            margin-top: 12px;
            display: flex;
            gap: 12px;
        }

        .btn-notification {
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--deep-blue);
            background: white;
            border: 1px solid var(--deep-blue);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-notification:hover {
            background: var(--deep-blue);
            color: white;
        }

        /* Footer */
        footer {
            background: #1E3A5F;
            color: var(--white);
            padding: 32px 40px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-logo {
            font-size: 18px;
            font-weight: 700;
        }

        .footer-text {
            font-size: 13px;
            opacity: 0.7;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .page-wrapper {
                flex-direction: column;
            }

            .project-meta {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .page-wrapper {
                padding: 20px;
            }

            .page-title {
                font-size: 24px;
            }

            .project-info-card,
            .accountant-profile-card,
            .revision-summary-card,
            .status-section {
                padding: 20px;
            }

            .project-meta {
                grid-template-columns: 1fr;
            }

            .profile-content {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- ì ‘ê·¼ ê¶Œí•œ í™•ì¸ -->
    <div id="access-denied" style="display:none;">
        <div style="text-align:center; padding:80px 20px; max-width:500px; margin:0 auto;">
            <div style="font-size:48px; margin-bottom:20px;">ğŸ”’</div>
            <h2 style="color:#1F2937; margin-bottom:12px;">ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
            <p style="color:#6B7280; margin-bottom:24px;">ì´ í˜ì´ì§€ëŠ” ë‹´ë‹¹ íšŒê³„ì‚¬ ë° ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>í˜„ì¬ ì§„í–‰ ìƒíƒœëŠ” ì‚¬ì´ë“œë°”ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <a href="../valuation.html" style="display:inline-block; padding:12px 24px; background:#166534; color:white; border-radius:8px; text-decoration:none; font-weight:600;">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>

    <script>
        // Supabase ì„¸ì…˜ ê¸°ë°˜ ì—­í•  ì²´í¬
        (function() {
            var role = localStorage.getItem('userRole') || 'customer';
            if (role === 'accountant' || role === 'admin') return;

            document.getElementById('access-denied').style.display = 'block';
            document.addEventListener('DOMContentLoaded', function() {
                var header = document.getElementById('header-container');
                if (header) header.style.display = 'none';
                var hero = document.querySelector('.hero-section');
                if (hero) hero.style.display = 'none';
                var pageWrapper = document.querySelector('.page-wrapper');
                if (pageWrapper) pageWrapper.style.display = 'none';
                var footer = document.querySelector('footer');
                if (footer) footer.style.display = 'none';

                var script = document.createElement('script');
                script.type = 'module';
                script.textContent = `
                    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
                    try {
                        const supabase = createClient(
                            'https://arxrfetgaitkgiiqabap.supabase.co',
                            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFyeHJmZXRnYWl0a2dpaXFhYmFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3ODk1OTgsImV4cCI6MjA4NDM2NTU5OH0.BTnuv0sYr2MGe1c-gk8PWCviwkFyIiymfKp5Jhzwbo0'
                        );
                        const { data: { session } } = await supabase.auth.getSession();
                        if (session && session.user) {
                            const email = session.user.email.toLowerCase();
                            const { data: userData } = await supabase
                                .from('users').select('role').eq('user_id', session.user.id).single();
                            const detectedRole = (userData && userData.role) ? userData.role
                                : (['wksun999@gmail.com'].includes(email) ? 'admin' : 'customer');
                            if (detectedRole === 'admin' || detectedRole === 'accountant') {
                                localStorage.setItem('userRole', detectedRole);
                                localStorage.setItem('userEmail', email);
                                location.reload();
                            }
                        }
                    } catch(e) { console.warn('Supabase ì„¸ì…˜ í™•ì¸ ì‹¤íŒ¨:', e); }
                `;
                document.body.appendChild(script);
            });
        })();
    </script>

    <!-- Header -->
    <div id="header-container"></div>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">í‰ê°€ë³´ê³ ì„œ ìµœì¢…ì•ˆ ì‘ì„±</h1>
            <p class="hero-subtitle">ë‹´ë‹¹ ê³µì¸íšŒê³„ì‚¬ê°€ ìˆ˜ì • ì‚¬í•­ì„ ë°˜ì˜í•˜ì—¬ ìµœì¢… ë³´ê³ ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤ (48ì‹œê°„ ì´ë‚´)</p>
            <div class="hero-badge">
                <span>í”„ë¡œì íŠ¸ ID: </span>
                <span id="hero-project-id">-</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="page-wrapper">
        <main class="main-content">

            <!-- Project Info Card -->
            <section class="project-info-card">
                <div class="project-header">
                    <div>
                        <h2 class="project-title" id="project-company-name">ë¡œë”© ì¤‘...</h2>
                        <span class="project-id" id="project-id">-</span>
                    </div>
                    <div class="project-status">
                        <span>âœï¸</span>
                        <span>ìµœì¢…ì•ˆ ì‘ì„± ì¤‘</span>
                    </div>
                </div>
                <div class="project-meta">
                    <div class="meta-item">
                        <div class="meta-label">í”„ë¡œì íŠ¸ ë²ˆí˜¸</div>
                        <div class="meta-value" id="project-number">-</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">í‰ê°€ ë°©ë²•</div>
                        <div class="meta-value" id="method-name">-</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">í‰ê°€ ê¸°ì¤€ì¼</div>
                        <div class="meta-value" id="evaluation-date">-</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">ë‹´ë‹¹ íšŒê³„ì‚¬</div>
                        <div class="meta-value">ì„ ì›…ê·œ íšŒê³„ì‚¬</div>
                    </div>
                </div>
            </section>

            <!-- Accountant Profile Card -->
            <section class="accountant-profile-card">
                <h3 class="card-title">
                    <span>ğŸ‘¨â€ğŸ’¼</span>
                    ë‹´ë‹¹ ê³µì¸íšŒê³„ì‚¬
                </h3>
                <div class="profile-content">
                    <div class="profile-photo">ì„ </div>
                    <div class="profile-details">
                        <h4 class="accountant-name">ì„ ì›…ê·œ ê³µì¸íšŒê³„ì‚¬</h4>
                        <p class="accountant-certification">ê³µì¸íšŒê³„ì‚¬ ìê²©ì¦ ë²ˆí˜¸: 12345</p>

                        <div class="profile-info-grid">
                            <div class="profile-info-item">
                                <span class="icon">ğŸ“…</span>
                                <div>
                                    <span class="text">ì‘ì—… ì‹œì‘:</span>
                                    <span class="value" id="work-start-date">-</span>
                                </div>
                            </div>
                            <div class="profile-info-item">
                                <span class="icon">â°</span>
                                <div>
                                    <span class="text">ì˜ˆìƒ ì™„ë£Œ:</span>
                                    <span class="value" id="expected-completion">-</span>
                                </div>
                            </div>
                            <div class="profile-info-item">
                                <span class="icon">ğŸ“Š</span>
                                <div>
                                    <span class="text">ì „ë¬¸ ë¶„ì•¼:</span>
                                    <span class="value">ìŠ¤íƒ€íŠ¸ì—… ë°¸ë¥˜ì—ì´ì…˜</span>
                                </div>
                            </div>
                            <div class="profile-info-item">
                                <span class="icon">âœ…</span>
                                <div>
                                    <span class="text">ì™„ë£Œ í”„ë¡œì íŠ¸:</span>
                                    <span class="value">247ê±´</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Revision Summary Card -->
            <section class="revision-summary-card">
                <div class="revision-header">
                    <h3 class="card-title">
                        <span>ğŸ“</span>
                        ìˆ˜ì • ìš”ì²­ ì‚¬í•­
                    </h3>
                    <span class="revision-count" id="revision-count">0ê°œ ì ‘ìˆ˜</span>
                </div>

                <div class="revision-list" id="revision-list">
                    <!-- Revision items will be dynamically inserted -->
                </div>

                <a href="#" class="view-details-link" onclick="viewRevisionDetails(event)">
                    <span>ìˆ˜ì • ìš”ì²­ ìƒì„¸ë³´ê¸°</span>
                    <span>â†’</span>
                </a>
            </section>

            <!-- Status Section -->
            <section class="status-section">
                <h3 class="card-title">
                    <span>âš™ï¸</span>
                    ì‘ì—… ì§„í–‰ ìƒí™©
                </h3>

                <div class="status-indicator">
                    <div class="status-icon">âœï¸</div>
                    <div class="status-text">ìµœì¢…ì•ˆ ì‘ì„± ì¤‘</div>
                    <div class="status-description">
                        ê³µì¸íšŒê³„ì‚¬ê°€ ê³ ê°ë‹˜ì˜ ìˆ˜ì • ìš”ì²­ì„ ê¼¼ê¼¼íˆ ê²€í† í•˜ì—¬<br>
                        ìµœì¢… ë³´ê³ ì„œë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>

                <div class="progress-steps">
                    <div class="step-item">
                        <div class="step-icon completed">âœ…</div>
                        <div class="step-content">
                            <div class="step-title">ìˆ˜ì • ìš”ì²­ í™•ì¸</div>
                            <div class="step-time" id="step1-time">-</div>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-icon in-progress">âš™ï¸</div>
                        <div class="step-content">
                            <div class="step-title">ìˆ˜ì • ì‚¬í•­ ë°˜ì˜ ì¤‘</div>
                            <div class="step-time">ì§„í–‰ ì¤‘</div>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-icon pending">â³</div>
                        <div class="step-content">
                            <div class="step-title">ìµœì¢… ê²€í†  ì˜ˆì •</div>
                            <div class="step-time">ëŒ€ê¸° ì¤‘</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Notice Box -->
            <div class="notice-box">
                <div class="notice-title">
                    <span>ğŸ””</span>
                    ì•Œë¦¼ ì„¤ì •
                </div>
                <div class="notice-text">
                    ìµœì¢… ë³´ê³ ì„œê°€ ì™„ë£Œë˜ë©´ ë“±ë¡í•˜ì‹  ì´ë©”ì¼ê³¼ SMSë¡œ ì•Œë¦¼ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
                    ì•Œë¦¼ ìˆ˜ì‹  ì„¤ì •ì„ ë³€ê²½í•˜ì‹œë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.
                </div>
                <div class="notice-actions">
                    <button class="btn-notification" onclick="updateNotificationSettings('email')">
                        ğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì •
                    </button>
                    <button class="btn-notification" onclick="updateNotificationSettings('sms')">
                        ğŸ“± SMS ì•Œë¦¼ ì„¤ì •
                    </button>
                </div>
            </div>
        </main>

    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-logo">ValueLink</div>
            <div class="footer-text">Â© 2026 ValueLink. All rights reserved.</div>
        </div>
    </footer>

    <!-- Header Load Script -->
    <script>
        fetch('../../components/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                const scripts = document.getElementById('header-container').querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });
            })
            .catch(error => console.error('í—¤ë” ë¡œë“œ ì‹¤íŒ¨:', error));
    </script>

    <!-- Module Script -->
    <script type="module">
        import { checkMethodStatus, METHOD_NAMES } from '../../components/project-status-checker.js';

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ í”„ë¡œì íŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('id') || 'DEMO-2026-DCF';
        const method = urlParams.get('method') || 'dcf';

        // Hero sectionì— í”„ë¡œì íŠ¸ ID í‘œì‹œ
        const heroProjectId = document.getElementById('hero-project-id');
        if (heroProjectId) heroProjectId.textContent = projectId;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        async function initializePage() {
            try {
                // í‰ê°€ë²• ìƒíƒœ í™•ì¸
                const { status, step } = await checkMethodStatus(projectId, method);

                // í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ
                displayProjectInfo();

                // ìˆ˜ì • ìš”ì²­ ì‚¬í•­ ë¡œë“œ
                loadRevisionRequests();

                // ì‘ì—… ì‹œì‘ ì¼ì‹œ ì„¤ì •
                setWorkTimeline();

            } catch (error) {
                console.error('í˜ì´ì§€ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ
        function displayProjectInfo() {
            const methodName = METHOD_NAMES[method] || method;

            // ì„ì‹œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” DBì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
            document.getElementById('project-company-name').textContent = '(ì£¼)íŒŒì¸ë”ì›”ë“œ';
            document.getElementById('project-id').textContent = projectId;
            document.getElementById('project-number').textContent = projectId;
            document.getElementById('method-name').textContent = methodName;
            const today = new Date();
            document.getElementById('evaluation-date').textContent = `${today.getFullYear()-1}.12.31`;
        }

        // ìˆ˜ì • ìš”ì²­ ì‚¬í•­ ë¡œë“œ
        async function loadRevisionRequests() {
            try {
                // ì‹¤ì œë¡œëŠ” DBì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨
                // ì„ì‹œ ë°ì´í„°
                const revisionRequests = [
                    {
                        id: 1,
                        title: 'ì¬ë¬´ ê°€ì • ì—…ë°ì´íŠ¸',
                        description: '2026ë…„ ë§¤ì¶œ ì„±ì¥ë¥ ì„ 35%ì—ì„œ 40%ë¡œ ì¡°ì • ìš”ì²­'
                    },
                    {
                        id: 2,
                        title: 'í• ì¸ìœ¨ ê·¼ê±° ë³´ì™„',
                        description: 'WACC ì‚°ì • ê³¼ì •ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª… ì¶”ê°€ í•„ìš”'
                    },
                    {
                        id: 3,
                        title: 'ìœ ì‚¬ ê¸°ì—… ë¹„êµ ì¶”ê°€',
                        description: 'êµ­ë‚´ ìœ ì‚¬ ê¸°ì—… 2ê°œ ì¶”ê°€ ë¶„ì„ ìš”ì²­'
                    }
                ];

                // ìˆ˜ì • ìš”ì²­ ê°œìˆ˜ í‘œì‹œ
                document.getElementById('revision-count').textContent = `${revisionRequests.length}ê°œ ì ‘ìˆ˜`;

                // ìˆ˜ì • ìš”ì²­ ëª©ë¡ ë Œë”ë§
                const revisionList = document.getElementById('revision-list');
                revisionList.innerHTML = revisionRequests.map(request => `
                    <div class="revision-item">
                        <div class="revision-number">${request.id}</div>
                        <div class="revision-content">
                            <div class="revision-title">${request.title}</div>
                            <div class="revision-description">${request.description}</div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('ìˆ˜ì • ìš”ì²­ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('revision-count').textContent = '0ê°œ ì ‘ìˆ˜';
            }
        }

        // ì‘ì—… ì‹œì‘ ì¼ì‹œ ì„¤ì •
        function setWorkTimeline() {
            const today = new Date();
            const startDate = new Date(today);
            const completionDate = new Date(today);
            completionDate.setDate(completionDate.getDate() + 2); // 48ì‹œê°„ ì´ë‚´

            const formatDate = (date) => {
                return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            };

            document.getElementById('work-start-date').textContent = formatDate(startDate);
            document.getElementById('expected-completion').textContent = formatDate(completionDate);
            document.getElementById('step1-time').textContent = `${formatDate(startDate)} ì™„ë£Œ`;
        }

        // ìˆ˜ì • ìš”ì²­ ìƒì„¸ë³´ê¸°
        window.viewRevisionDetails = function(event) {
            event.preventDefault();
            // ì‹¤ì œë¡œëŠ” ìˆ˜ì • ìš”ì²­ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
            alert('ìˆ˜ì • ìš”ì²­ ìƒì„¸ ë‚´ì—­ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        };

        // ì•Œë¦¼ ì„¤ì • ì—…ë°ì´íŠ¸
        window.updateNotificationSettings = function(type) {
            const typeText = type === 'email' ? 'ì´ë©”ì¼' : 'SMS';
            alert(`${typeText} ì•Œë¦¼ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
            // ì‹¤ì œë¡œëŠ” ì•Œë¦¼ ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™
        };

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        window.handleLogout = async function() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì‹¤ì œë¡œëŠ” Supabase ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
                window.location.href = '../valuation.html';
            }
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        initializePage();
    </script>
</body>
</html>
